{% extends "base.html" %}

{% block js %}
{% endblock %}

{% block css %}
{{formset.media}}
{% endblock %}

{% block breadcrumbs %}
{% endblock %}


{% block content %}
  {%if user.is_anonymous%}
  <div class="textblock">
  <h1>Welcome!</h1>
  <p><a href="{%url djangowind.views.login %}?next=/">LOGIN!</a>
  </p>
  </div>
  {%else%}
  <div class="textblock">
  <h1>{{user.get_full_name|default:user.username}}'s Dashboard</h1>
  
  {%if is_faculty%}
  <h2>Team Details</h2>
  <a href="{%url team-admin %}">Team Administration and Assignment</a>
  {%endif%}

   {%if team%}
 <div id="alertbox">
 <h2>Your Team</h2>
  
  <ul>
    {%for member in team.group.user_set.all %}
    <li>{{member.get_full_name|default:member.username}}</li>
    {%endfor%}
  </ul>
  </div>
  {%endif%}

  <p>
  {%for survey in todo %}
  <h2>Welcome!</h2>
  <b> Please fill out your <a href="{%url survey-detail survey.slug %}">{{survey.title}}</a></b>
  {%endfor%}
 
  </p>
 <h2>Assignments</h2>
  <!--fake table-->

  {%if is_faculty%}
     <form method="POST">
     <input type="submit" value="Save" />
       {{ formset.management_form }}
  {%endif%}
  <table>
    <thead>
      <tr>
	<th>Activity Name</th>
	<th>Type</th>
	<th>Due Date</th>
	<th>Status</th>
      </tr>
    </thead>
    <tbody>
      {%for assn in assignments %}
      {%if not assn.hidden or is_faculty %}
      <tr 
	  {%if assn.current %}
	  class="current"
	  {%endif%}
	  >
	<td>
	    {{assn.data.name}}
	    {%if team %}
	    <br />
	    <a href="{%url assignment-page assn.data.id %}">
	      {%if assn.current %}
	      Open
	      {%else%}
	      Review
	      {%endif%}
	    </a>
	    {%endif%}
	    {%if is_faculty%}
	    <br />
	    <a href="{%url assignment-page assignment_id=assn.data.id,faculty_view="/instructor/",user_id=teams.0.group.user_set.all.0.id %}">Review Submissions</a>
	    Open: {{assn.form.visible_fields.1}}
	    {%endif%}
	</td>
	<td>{{assn.data.individual|yesno:"Individual,Group"}}
	</td>
	<td style="width:15em;">
	  {%if is_faculty%}
	    {% for hidden in assn.form.hidden_fields %}
	       {{ hidden }}
	    {% endfor %}

	    {{assn.form.visible_fields.0}}
          {%else%}
            {{assn.data.close_date|date:"l, n/j/y, P"}}
	  {%endif%}
	</td>
	<td>
	  {%for ateam in assn.teams %}
	    {%ifequal team ateam.data %}
	    <!--STUDENT-->
	      {%if ateam.sub %}
	         {%if ateam.sub.0.published %}
		    Submitted
		    {{ateam.sub.0.modified|date:"n/j/y, P"}}
		 {%else%}
		    Draft
		 {%endif%}
	      {%endif%}
	    {%endifequal%}
	    {%if is_faculty %}
	      {%ifequal ateam.data.state.turn ateam.turn %}
	        <div class="teamoptions"><div
		   {%if ateam.sub.0.published %}
		   class="on" title="published"
		   {%endif%}
		  >{{ateam.data.index}}</div></div>
	      {%endifequal%}
	    {%endif%}
	  {%endfor%}
	</td>
      </tr>
      {%endif%}
      {%endfor%}
    </tbody>
  </table>
  {%if is_faculty%}
  <input type="submit" value="Save" />
  </form>  
  {%endif%}

  <h2>Temp game list (TEMP:Just to Display)</h2>
  <ul>
    {%for g in games %}
    <li><a href="{%url game-page g.0 %}">{{g.1}}</a></li>
    {%endfor%}
  </ul>
  
<!--end real table  -->
  
  
  
  
  
  
  </div>

  {%endif%}

  {% endblock %}
